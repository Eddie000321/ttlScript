; Filename: Cisco_Router_Recovery.ttl
; Description: Automates password recovery and factory reset for Cisco Routers based on the provided documentation.
; Reference: Page 2-3 of the documentation.

; Set a long timeout because router booting takes time
timeout = 600

; --- Step 1: Bypass Password Check ---
wait 'rommon 1 >'
sendln 'confreg 0x2142'
wait 'rommon 2 >'
sendln 'reset'

; --- Step 2: Wait for Boot ---
; The router will restart. We need to decline the initial configuration dialog.
wait 'initial configuration dialog? [yes/no]:'
sendln 'no'

; --- Step 3: Erase Old Settings ---
wait 'Router>'
sendln 'enable'
wait 'Router#'
sendln 'write erase'

; Handle confirmation prompt
wait 'confirm'
sendln '' 

; --- Step 4: Restore Register and Reload ---
wait 'Router#'
sendln 'configure terminal'
wait '(config)#'
sendln 'config-register 0x2102'
sendln 'end'

; Reload to apply changes
wait 'Router#'
sendln 'reload'

; If asked to save, say NO (we want a clean slate)
wait 'System configuration has been modified'
sendln 'no'

; Confirm reload
wait 'proceed'
sendln ''

messagebox 'Router recovery process complete!' 'Finished'